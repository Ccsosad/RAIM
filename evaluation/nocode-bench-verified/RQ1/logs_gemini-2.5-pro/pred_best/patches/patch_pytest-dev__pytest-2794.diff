diff --git a/_pytest/logging.py b/_pytest/logging.py
new file mode 100644
index 0000000..7d16661
--- /dev/null
+++ b/_pytest/logging.py
@@ -0,0 +1,156 @@
+"""Internal pytest plugin for managing logging during tests."""
+import logging
+from contextlib import contextmanager
+
+import py
+import pytest
+from _pytest.config import hookimpl
+
+
+def pytest_addoption(parser):
+    """Add options to control logging."""
+    group = parser.getgroup("logging")
+
+    group.addoption("--log-format", dest="log_format", help="log format as used by the logging module.")
+    group.addoption("--log-date-format", dest="log_date_format", help="log date format as used by the logging module.")
+    group.addoption("--no-print-logs", dest="log_print", default=True, action="store_false", help="disable printing caught logs on failed tests.")
+    group.addoption("--log-cli-level", dest="log_cli_level", help="cli logging level.")
+    group.addoption("--log-cli-format", dest="log_cli_format", help="log format as used by the logging module.")
+    group.addoption("--log-cli-date-format", dest="log_cli_date_format", help="log date format as used by the logging module.")
+    group.addoption("--log-file", dest="log_file", help="path to a file when logging is written to.")
+    group.addoption("--log-file-level", dest="log_file_level", help="log file logging level.")
+    group.addoption("--log-file-format", dest="log_file_format", default="%(asctime)s %(levelname)-8s %(name)s:%(lineno)d %(message)s", help="log format as used by the logging module.")
+    group.addoption("--log-file-date-format", dest="log_file_date_format", help="log date format as used by the logging module.")
+
+    parser.addini("log_format", "log format as used by the logging module.", default="%(levelname)-8s %(name)s:%(lineno)d %(message)s")
+    parser.addini("log_date_format", "log date format as used by the logging module.")
+    parser.addini("log_print", "disable printing caught logs on failed tests.", type="bool", default=True)
+    parser.addini("log_cli_level", "cli logging level.")
+    parser.addini("log_cli_format", "log format as used by the logging module.")
+    parser.addini("log_cli_date_format", "log date format as used by the logging module.")
+    parser.addini("log_file", "path to a file when logging is written to.")
+    parser.addini("log_file_level", "log file logging level.")
+    parser.addini("log_file_format", "log format as used by the logging module.", default="%(asctime)s %(levelname)-8s %(name)s:%(lineno)d %(message)s")
+    parser.addini("log_file_date_format", "log date format as used by the logging module.")
+
+
+@hookimpl(trylast=True)
+def pytest_configure(config):
+    config.pluginmanager.register(LoggingPlugin(config), "logging-plugin")
+
+
+class LogCaptureHandler(logging.Handler):
+    def __init__(self):
+        super(LogCaptureHandler, self).__init__()
+        self.records = []
+
+    def emit(self, record):
+        self.records.append(record)
+
+    def clear(self):
+        self.records = []
+
+
+class LoggingPlugin(object):
+    def __init__(self, config):
+        self.config = config
+        self.log_print = config.getini("log_print")
+        self.capture_handler = LogCaptureHandler()
+
+        log_format = config.getoption("log_format") or config.getini("log_format")
+        log_date_format = config.getoption("log_date_format") or config.getini("log_date_format")
+        self.formatter = logging.Formatter(log_format, log_date_format)
+        self.capture_handler.setFormatter(self.formatter)
+
+        self.root_logger = logging.getLogger()
+        self.original_handlers = self.root_logger.handlers[:]
+        self.original_level = self.root_logger.level
+        self.root_logger.addHandler(self.capture_handler)
+        self.root_logger.setLevel(logging.DEBUG)
+
+        log_cli_level = config.getoption("log_cli_level") or config.getini("log_cli_level")
+        if log_cli_level:
+            self.log_cli_handler = logging.StreamHandler()
+            self.log_cli_handler.setLevel(_check_log_level(log_cli_level))
+            cli_format = config.getoption("log_cli_format") or config.getini("log_cli_format") or log_format
+            cli_date_format = config.getoption("log_cli_date_format") or config.getini("log_cli_date_format") or log_date_format
+            self.log_cli_handler.setFormatter(logging.Formatter(cli_format, cli_date_format))
+            self.root_logger.addHandler(self.log_cli_handler)
+
+        log_file = config.getoption("log_file") or config.getini("log_file")
+        if log_file:
+            self.log_file_handler = logging.FileHandler(log_file, "w")
+            log_file_level = config.getoption("log_file_level") or config.getini("log_file_level")
+            if log_file_level:
+                self.log_file_handler.setLevel(_check_log_level(log_file_level))
+            log_file_format = config.getoption("log_file_format") or config.getini("log_file_format")
+            log_file_date_format = config.getoption("log_file_date_format") or config.getini("log_file_date_format")
+            self.log_file_handler.setFormatter(logging.Formatter(log_file_format, log_file_date_format))
+            self.root_logger.addHandler(self.log_file_handler)
+
+    def pytest_unconfigure(self, config):
+        self.root_logger.setLevel(self.original_level)
+        self.root_logger.handlers = self.original_handlers
+
+    @pytest.hookimpl(hookwrapper=True)
+    def pytest_runtest_setup(self, item):
+        yield
+        self.capture_handler.clear()
+
+    @pytest.hookimpl(tryfirst=True)
+    def pytest_runtest_logreport(self, report):
+        if self.log_print and report.failed and self.capture_handler.records:
+            report.sections.append(("stdlog", "\n".join(self.formatter.format(r) for r in self.capture_handler.records)))
+
+
+class CaplogFixture(object):
+    def __init__(self, item):
+        self._plugin = item.config.pluginmanager.get_plugin("logging-plugin")
+        self._handler = self._plugin.capture_handler
+        self._initial_levels = {}
+
+    @property
+    def text(self):
+        return "\n".join(self._handler.formatter.format(r) for r in self.records)
+
+    @property
+    def records(self):
+        return self._handler.records
+
+    @property
+    def record_tuples(self):
+        return [(r.name, r.levelno, r.getMessage()) for r in self.records]
+
+    def clear(self):
+        self._handler.clear()
+
+    def set_level(self, level, logger=None):
+        logger_obj = logging.getLogger(logger)
+        if logger_obj not in self._initial_levels:
+            self._initial_levels[logger_obj] = logger_obj.level
+        logger_obj.setLevel(level)
+
+    @contextmanager
+    def at_level(self, level, logger=None):
+        logger_obj = logging.getLogger(logger)
+        old_level = logger_obj.level
+        logger_obj.setLevel(level)
+        yield
+        logger_obj.setLevel(old_level)
+
+    def _finalize(self):
+        for logger, level in self._initial_levels.items():
+            logger.setLevel(level)
+
+
+@pytest.fixture
+def caplog(request):
+    fixture = CaplogFixture(request.node)
+    yield fixture
+    fixture._finalize()
+
+
+def _check_log_level(level):
+    if isinstance(level, py.builtin.string_types):
+        level = level.upper()
+    return logging._checkLevel(level)

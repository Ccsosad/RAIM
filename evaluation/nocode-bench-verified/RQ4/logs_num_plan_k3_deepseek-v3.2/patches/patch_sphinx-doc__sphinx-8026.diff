diff --git a/sphinx/builders/__init__.py b/sphinx/builders/__init__.py
index 796b7ad..9ed2425 100644
--- a/sphinx/builders/__init__.py
+++ b/sphinx/builders/__init__.py
@@ -176,7 +176,7 @@ class Builder:
         """Return list of paths for assets (ex. templates, CSS, etc.)."""
         return []
 
-    def post_process_images(self, doctree: Node) -> None:
+    def post_process_images(self, doctree: Node, docname: str = None) -> None:
         """Pick the best candidate for all image URIs."""
         images = ImageAdapter(self.env)
         for node in doctree.traverse(nodes.image):
@@ -205,6 +205,10 @@ class Builder:
             if candidate not in self.env.images:
                 # non-existing URI; let it alone
                 continue
+            # If the image filename has a {docpath} token, replace it with the document's path
+            if docname and '{docpath}' in candidate:
+                docpath = images.get_docpath(docname)
+                candidate = candidate.replace('{docpath}', docpath)
             self.images[candidate] = self.env.images[candidate][1]
 
     # compile po methods
@@ -617,4 +621,4 @@ class Builder:
             return getattr(self.config, optname)
         except AttributeError:
             optname = '%s_%s' % (default, option)
-            return getattr(self.config, optname)
+            return getattr(self.config, optname)
diff --git a/sphinx/builders/html/__init__.py b/sphinx/builders/html/__init__.py
index c052c27..8e03d61 100644
--- a/sphinx/builders/html/__init__.py
+++ b/sphinx/builders/html/__init__.py
@@ -604,7 +604,7 @@ class StandaloneHTMLBuilder(Builder):
 
     def write_doc_serialized(self, docname: str, doctree: nodes.document) -> None:
         self.imgpath = relative_uri(self.get_target_uri(docname), self.imagedir)
-        self.post_process_images(doctree)
+        self.post_process_images(doctree, docname)
         title_node = self.env.longtitles.get(docname)
         title = self.render_partial(title_node)['title'] if title_node else ''
         self.index_page(docname, doctree, title)
@@ -817,11 +817,11 @@ class StandaloneHTMLBuilder(Builder):
         if self.theme:
             self.theme.cleanup()
 
-    def post_process_images(self, doctree: Node) -> None:
+    def post_process_images(self, doctree: Node, docname: str = None) -> None:
         """Pick the best candidate for an image and link down-scaled images to
         their high res version.
         """
-        Builder.post_process_images(self, doctree)
+        Builder.post_process_images(self, doctree, docname)
 
         if self.config.html_scaled_image_link and self.html_scaled_image_link:
             for node in doctree.traverse(nodes.image):
diff --git a/sphinx/environment/adapters/asset.py b/sphinx/environment/adapters/asset.py
index 2e81c26..fa85c6d 100644
--- a/sphinx/environment/adapters/asset.py
+++ b/sphinx/environment/adapters/asset.py
@@ -20,4 +20,21 @@ class ImageAdapter:
         while name in self.env.original_image_uri:
             name = self.env.original_image_uri[name]
 
-        return name
+        return name
+
+    def get_docpath(self, docname: str) -> str:
+        """Get the directory path for the current document, with a trailing slash if non-empty."""
+        dirname = posixpath.dirname(docname)
+        if dirname:
+            return dirname + '/'
+        else:
+            return ''
+
+    def get_docpath(self, docname: str) -> str:
+        """Get the directory path for the current document, with a trailing slash if non-empty."""
+        import posixpath
+        dirname = posixpath.dirname(docname)
+        if dirname:
+            return dirname + '/'
+        else:
+            return ''

diff --git a/_pytest/config/__init__.py b/_pytest/config/__init__.py
new file mode 100644
index 0000000..3b4507f
--- /dev/null
+++ b/_pytest/config/__init__.py
@@ -0,0 +1,145 @@
+import logging
+import sys
+from _pytest.config import Config
+from _pytest.config import Parser
+from _pytest.config import hookimpl
+
+def pytest_addoption(parser):
+    """Add options to control log capturing."""
+    group = parser.getgroup("logging")
+
+    group.addoption(
+        "--log-level",
+        dest="log_level",
+        default=None,
+        help="Default logging level for loggers"
+    )
+
+    group.addoption(
+        "--log-format",
+        dest="log_format",
+        default="%(levelname)-8s %(name)s %(message)s",
+        help="Log format used by the logging module"
+    )
+
+    group.addoption(
+        "--log-date-format",
+        dest="log_date_format",
+        default=None,
+        help="Log date format used by the logging module"
+    )
+
+    group.addoption(
+        "--log-cli-level",
+        dest="log_cli_level",
+        default=None,
+        help="Log level for the console logging"
+    )
+
+    group.addoption(
+        "--log-cli-format",
+        dest="log_cli_format",
+        default=None,
+        help="Log format for the console logging"
+    )
+
+    group.addoption(
+        "--log-cli-date-format",
+        dest="log_cli_date_format",
+        default=None,
+        help="Log date format for the console logging"
+    )
+
+    group.addoption(
+        "--log-file",
+        dest="log_file",
+        default=None,
+        help="Path to a file when logging will be written to"
+    )
+
+    group.addoption(
+        "--log-file-level",
+        dest="log_file_level",
+        default=None,
+        help="Log level for the file logging"
+    )
+
+    group.addoption(
+        "--log-file-format",
+        dest="log_file_format",
+        default=None,
+        help="Log format for the file logging"
+    )
+
+    group.addoption(
+        "--log-file-date-format",
+        dest="log_file_date_format",
+        default=None,
+        help="Log date format for the file logging"
+    )
+
+    group.addoption(
+        "--no-print-logs",
+        dest="log_print",
+        action="store_false",
+        default=True,
+        help="Disable printing captured logs on failed tests"
+    )
+
+    parser.addini(
+        "log_level",
+        help="Default logging level for loggers"
+    )
+
+    parser.addini(
+        "log_format",
+        default="%(levelname)-8s %(name)s %(message)s",
+        help="Log format used by the logging module"
+    )
+
+    parser.addini(
+        "log_date_format",
+        help="Log date format used by the logging module"
+    )
+
+    parser.addini(
+        "log_cli_level",
+        help="Log level for the console logging"
+    )
+
+    parser.addini(
+        "log_cli_format",
+        help="Log format for the console logging"
+    )
+
+    parser.addini(
+        "log_cli_date_format",
+        help="Log date format for the console logging"
+    )
+
+    parser.addini(
+        "log_file",
+        help="Path to a file when logging will be written to"
+    )
+
+    parser.addini(
+        "log_file_level",
+        help="Log level for the file logging"
+    )
+
+    parser.addini(
+        "log_file_format",
+        help="Log format for the file logging"
+    )
+
+    parser.addini(
+        "log_file_date_format",
+        help="Log date format for the file logging"
+    )
+
+    parser.addini(
+        "log_print",
+        default=True,
+        type="bool",
+        help="Print captured logs on failed tests"
+    )
diff --git a/_pytest/logging.py b/_pytest/logging.py
new file mode 100644
index 0000000..c831320
--- /dev/null
+++ b/_pytest/logging.py
@@ -0,0 +1,156 @@
+import logging
+import sys
+import io
+from contextlib import contextmanager
+from _pytest.config import hookimpl
+from _pytest.fixtures import fixture
+
+class LogCaptureHandler(logging.StreamHandler):
+    """A logging handler that stores log records and the log text."""
+
+    def __init__(self):
+        super().__init__(io.StringIO())
+        self.records = []
+
+    def emit(self, record):
+        self.records.append(record)
+        super().emit(record)
+
+    def reset(self):
+        self.records = []
+        self.stream = io.StringIO()
+
+    def get_records(self):
+        return self.records
+
+    def get_text(self):
+        return self.stream.getvalue()
+
+class LogCaptureFixture:
+    """Fixture to capture log messages."""
+
+    def __init__(self, handler):
+        self.handler = handler
+        self._initial_levels = {}
+
+    def set_level(self, level, logger=None):
+        """Set the level of a logger or the handler if logger is None."""
+        if logger is None:
+            self.handler.setLevel(level)
+        else:
+            logger_obj = logging.getLogger(logger)
+            self._initial_levels.setdefault(logger, logger_obj.level)
+            logger_obj.setLevel(level)
+
+    @contextmanager
+    def at_level(self, level, logger=None):
+        """Context manager to temporarily set the level."""
+        if logger is None:
+            old_level = self.handler.level
+            self.handler.setLevel(level)
+            try:
+                yield
+            finally:
+                self.handler.setLevel(old_level)
+        else:
+            logger_obj = logging.getLogger(logger)
+            old_level = logger_obj.level
+            logger_obj.setLevel(level)
+            try:
+                yield
+            finally:
+                logger_obj.setLevel(old_level)
+
+    @property
+    def text(self):
+        """Return the captured log text."""
+        return self.handler.get_text()
+
+    @property
+    def records(self):
+        """Return the captured log records."""
+        return self.handler.get_records()
+
+    @property
+    def record_tuples(self):
+        """Return a list of tuples (logger_name, level, message)."""
+        return [(r.name, r.levelno, r.getMessage()) for r in self.records]
+
+    def clear(self):
+        """Clear the captured records and text."""
+        self.handler.reset()
+
+@fixture
+def caplog(request):
+    """Fixture to capture log messages."""
+    # Get the handler from the logging plugin
+    plugin = request.config.pluginmanager.getplugin("logging-plugin")
+    handler = plugin.handler
+    return LogCaptureFixture(handler)
+
+class LoggingPlugin:
+    """A plugin to capture log messages."""
+
+    def __init__(self, config):
+        self.config = config
+        self.handler = None
+        self._original_handlers = {}
+
+    @hookimpl(hookwrapper=True)
+    def pytest_runtest_setup(self, item):
+        """Set up log capturing for the test item."""
+        self._start_capturing()
+        yield
+        self._stop_capturing()
+
+    @hookimpl(hookwrapper=True)
+    def pytest_runtest_call(self, item):
+        """Capture logs during test execution."""
+        self._start_capturing()
+        yield
+        self._stop_capturing()
+
+    @hookimpl(hookwrapper=True)
+    def pytest_runtest_teardown(self, item):
+        """Capture logs during teardown."""
+        self._start_capturing()
+        yield
+        self._stop_capturing()
+
+    def _start_capturing(self):
+        """Start capturing logs by adding our handler to the root logger."""
+        if self.handler is None:
+            self.handler = LogCaptureHandler()
+            # Configure the handler with the formatter from config
+            formatter = logging.Formatter(
+                fmt=self.config.getini("log_format"),
+                datefmt=self.config.getini("log_date_format")
+            )
+            self.handler.setFormatter(formatter)
+            self.handler.setLevel(logging.NOTSET)
+
+        root_logger = logging.getLogger()
+        self._original_handlers[root_logger] = root_logger.handlers[:]
+        root_logger.handlers = [self.handler]
+
+    def _stop_capturing(self):
+        """Stop capturing logs by restoring the original handlers."""
+        root_logger = logging.getLogger()
+        root_logger.handlers = self._original_handlers.get(root_logger, [])
+
+    @hookimpl
+    def pytest_runtest_logreport(self, report):
+        """Add captured log to the report if the test failed."""
+        if report.failed and self.config.getini("log_print"):
+            if self.handler is not None:
+                log_text = self.handler.get_text()
+                if log_text:
+                    report.sections.append(("Captured stdlog call", log_text))
+
+def pytest_configure(config):
+    """Register the logging plugin if not disabled."""
+    if config.option.log_print is False:
+        config.option.log_print = False
+    if not config.pluginmanager.hasplugin("logging-plugin"):
+        plugin = LoggingPlugin(config)
+        config.pluginmanager.register(plugin, "logging-plugin")
